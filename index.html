<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#0b7e88"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <title>ุฑุงุตุฏ โข ูุชุงุจุนุฉ ุงูููุงุธุจุฉ ูุงูุณููู</title>

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="icon-192.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="app.css">
</head>
<body>
  <div class="topbar">
    <div class="container">
      <div class="brand">
        <div class="title">
          <div class="logo" aria-hidden="true"></div>
          <div class="hgroup">
            <h1>ุฑุงุตุฏ โข ูุชุงุจุนุฉ ุงูููุงุธุจุฉ ูุงูุณููู</h1>
            <p id="bSchool">โ</p>
          </div>
        </div>
        <div class="badges">
          <div class="badge" id="bTerm">โ</div>
          <div class="badge" id="bYear">โ</div>
        </div>
      </div>

      <div class="nav" role="tablist" aria-label="ุงูุชููู">
        <button class="tab" data-action="tab" data-tab="home" aria-selected="true">๐ ุงูุฑุฆูุณูุฉ</button>
        <button class="tab" data-action="tab" data-tab="attendance" aria-selected="false">โฑ๏ธ ุงูููุงุธุจุฉ</button>
        <button class="tab" data-action="tab" data-tab="behavior" aria-selected="false">โ๏ธ ุงูุณููู</button>
        <button class="tab" data-action="tab" data-tab="prints" aria-selected="false">๐จ๏ธ ุงููุดูู ูุงูุทุจุงุนุฉ</button>
        <button class="tab" data-action="tab" data-tab="settings" aria-selected="false">โ๏ธ ุงูุฅุนุฏุงุฏุงุช</button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- HOME -->
    <section class="page" id="home">
      <div class="grid">
        <div class="card">
          <h2>ุจุญุซ ุงูุทุงูุจ</h2>
          <div class="row">
            <div class="field" style="flex:2">
              <label>ุงุจุญุซ ุจุงูุงุณู ุฃู ุฑูู ุงููููุฉ</label>
              <input id="q" inputmode="search" placeholder="ูุซุงู: ูุญูุฏโฆ ุฃู 1148โฆ">
            </div>
            <div class="field">
              <label>ุงููุงุฆู ุจุงูุชุณุฌูู</label>
              <input id="actor" placeholder="ุงุณู ุงููุนูู/ุงูููุธู">
            </div>
          </div>
          <div class="hr"></div>
          <div id="searchResults"></div>
        </div>

        <div class="card">
          <h2>ูุคุดุฑุงุช ุณุฑูุนุฉ</h2>
          <div class="row">
            <div class="help" style="flex:1">
              <div style="font-weight:900">ุนุฏุฏ ุงูุทูุงุจ</div>
              <div style="font-size:22px" id="stats_students">0</div>
            </div>
            <div class="help" style="flex:1">
              <div style="font-weight:900">ุฅุฌูุงูู ุงูุณุฌูุงุช</div>
              <div style="font-size:22px" id="stats_logs">0</div>
            </div>
          </div>
          <div class="hr"></div>
          <div class="small">
            * ูุนูู ุงูุชุทุจูู ุจุฏูู ุฅูุชุฑูุช ุจุนุฏ ุงูุงุณุชูุฑุงุฏุ ูุน ุญูุธ ูุงูู ุฏุงุฎู ุงูุฌูุงุฒ.
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:14px">
        <h2>ุจุทุงูุฉ ุงูุทุงูุจ</h2>
        <div id="studentCard"></div>
        <div class="hr"></div>
        <h2 style="margin-top:0">ุณุฌู ุขุฎุฑ 30 ุฅุฌุฑุงุก</h2>
        <div id="logList"></div>
      </div>
    </section>

    <!-- ATTENDANCE -->
    <section class="page" id="attendance" hidden>
      <div class="grid">
        <div class="card">
          <h2>ุชุณุฌูู ุชุฃุฎุฑ</h2>
          <div class="field">
            <label>ููุงุญุธุฉ ูุฎุชุตุฑุฉ (ุงุฎุชูุงุฑู)</label>
            <input id="late_note" placeholder="ูุซุงู: ุชุฃุฎุฑ ุนู ุงูุทุงุจูุฑ / ุนุฐุฑ ูุฐููุฑโฆ">
          </div>
          <div class="actions">
            <button class="btn primary" data-action="add-late">ุชุณุฌูู ุงูุชุฃุฎุฑ</button>
            <button class="btn ghost" data-action="print-entry-card">ุทุจุงุนุฉ ูุฑูุฉ ุฅุฐู ุฏุฎูู</button>
          </div>
          <div class="small">ูููุถู ุชูุซูู ุงูููุงุญุธุฉ ุจุดูู ุชุฑุจูู ููุฌุฒ ุญุณุจ ุงูุฅุฌุฑุงุกุงุช ุงููุนุชูุฏุฉ.</div>
        </div>

        <div class="card">
          <h2>ุชุณุฌูู ุบูุงุจ</h2>
          <div class="field">
            <label>ููุงุญุธุฉ ูุฎุชุตุฑุฉ (ุงุฎุชูุงุฑู)</label>
            <input id="abs_note" placeholder="ูุซุงู: ุบูุงุจ ุฏูู ุนุฐุฑ / ุนุฐุฑ (ุจุงูุชุธุงุฑ ุงูุฅุซุจุงุช)โฆ">
          </div>
          <div class="actions">
            <button class="btn primary" data-action="add-absent">ุชุณุฌูู ุงูุบูุงุจ</button>
            <button class="btn ghost" data-action="print-entry-card">ุทุจุงุนุฉ ูุฑูุฉ ุฅุฐู ุฏุฎูู</button>
          </div>
          <div class="small">ุนูุฏ ุชูุฑุงุฑ ุงูุบูุงุจ ูููุซูู ุงูุชูุงุตู ูุน ููู ุงูุฃูุฑ ูุงูุฅุฌุฑุงุก ุงููุชุฎุฐ.</div>
        </div>
      </div>

      <div class="card" style="margin-top:14px">
        <h2>ุฅุฑุณุงู SMS ูููู ุงูุฃูุฑ (ุงุฎุชูุงุฑู)</h2>
        <div class="help">ูุฃูุงู ุงูุชููู: ูุง ูุชู ุงูุฅุฑุณุงู ูุจุงุดุฑุฉ ูู ุงูุชุทุจูู. ูุฌุจ ุถุจุท ูุณูุท (Proxy) ูุซู Cloudflare Worker ุฏุงุฎู ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช.</div>
        <div class="field" style="margin-top:10px">
          <label>ูุต ุงูุฑุณุงูุฉ</label>
          <textarea id="sms_body" placeholder="ูุซุงู: ูุฃูู ูุชุงุจุนุฉ ููุงุธุจุฉ ุงูุทุงูุจโฆ"></textarea>
        </div>
        <div class="actions">
          <button class="btn primary" id="btnSendSMS" data-action="send-sms">ุฅุฑุณุงู SMS</button>
        </div>
      </div>
    </section>

    <!-- BEHAVIOR -->
    <section class="page" id="behavior" hidden>
      <div class="grid">
        <div class="card">
          <h2>ุชุณุฌูู ูุฎุงููุฉ ุณููููุฉ</h2>
          <div class="field">
            <label>ุงุฎุชุฑ ุงููุฎุงููุฉ</label>
            <select id="beh_rule"></select>
          </div>
          <div class="row" style="margin-top:8px">
            <div class="help" style="flex:1">
              <div class="mini">ุงูุฏุฑุฌุฉ</div>
              <div style="font-weight:900;font-size:18px" id="beh_sev">โ</div>
            </div>
            <div class="help" style="flex:2">
              <div class="mini">ููุงุญุธุฉ</div>
              <div class="mini">ุงุฎุชุฑ ุงููุฎุงููุฉ ุซู ุนุฏูู ุงูุฅุฌุฑุงุกุงุช ุญุณุจ ุงูุญุงุฌุฉ.</div>
            </div>
          </div>
          <div class="field" style="margin-top:8px">
            <label>ุงูุฅุฌุฑุงุกุงุช ุงููุชุฎุฐุฉ (ูุงุจูุฉ ููุชุนุฏูู)</label>
            <textarea id="beh_actions" placeholder="ูุซุงู: ุชูุจูู + ุฅุดุนุงุฑ ููู ุงูุฃูุฑโฆ"></textarea>
          </div>
          <div class="field" style="margin-top:8px">
            <label>ุชูุงุตูู/ุชูุถูุญ (ุงุฎุชูุงุฑู)</label>
            <textarea id="beh_note" placeholder="ูุตู ููุฌุฒ ูููุงูุนุฉ ุฏูู ูุจุงูุบุฉโฆ"></textarea>
          </div>
          <div class="actions">
            <button class="btn primary" data-action="add-behavior">ุชุณุฌูู ุงููุฎุงููุฉ</button>
            <button class="btn ghost" data-action="print-behavior-card">ุทุจุงุนุฉ ุฅุดุนุงุฑ</button>
          </div>
          <div class="small">ููุงุญุธุฉ: ุงููุงุฆูุฉ ุงูุชุฑุงุถูุฉ ููููู ุชุญุฏูุซูุง ููู ุงูุฏููู ุงููุนุชูุฏ ูุฏููู.</div>
        </div>

        <div class="card">
          <h2>ุนุฑุถ ุจุทุงูุฉ ุงูุทุงูุจ</h2>
          <div id="studentCardBeh" class="help">ุงุฑุฌุน ููุฑุฆูุณูุฉ ูุงุฎุชุฑ ุงูุทุงูุจ ุซู ุนุฏ ููุง.</div>
          <div class="hr"></div>
          <div class="small">* ุณูุชู ุงุณุชุฎุฏุงู ููุณ ุงูุทุงูุจ ุงููุฎุชุงุฑ ูู ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ.</div>
        </div>
      </div>
    </section>

    <!-- PRINTS -->
    <section class="page" id="prints" hidden>
      <div class="grid">
        <div class="card">
          <h2>ุฅูุดุงุก ูุดู ูุชุงุจุนุฉ</h2>
          <div class="row">
            <div class="field">
              <label>ุงูุตู</label>
              <select id="sheet_grade"></select>
            </div>
            <div class="field">
              <label>ุงูุดุนุจุฉ</label>
              <select id="sheet_section"></select>
            </div>
            <div class="field">
              <label>ุงูุชุงุฑูุฎ</label>
              <input type="date" id="sheet_date">
            </div>
          </div>
          <div class="actions">
            <button class="btn primary" data-action="print-late-sheet">ุทุจุงุนุฉ ูุดู ุงูุชุฃุฎุฑ</button>
            <button class="btn primary" data-action="print-abs-sheet">ุทุจุงุนุฉ ูุดู ุงูุบูุงุจ</button>
          </div>
          <div class="small">ุงููุดู A4 ุฃููู โข ุงูุฃุนูุฏุฉ: ุงูุฃุญุฏโุงูุฎููุณ + ุจุงุฑููุฏ ุงููููุฉ.</div>
        </div>

        <div class="card">
          <h2>ุทุจุงุนุฉ ุจุทุงูุฉ (ูุฑูุฉ ุฅุฐู)</h2>
          <div class="help">
            ุชูุทุจุน ุนูู ูุฑู ุตุบูุฑ (80mm) ุจุดูู ูุงุถุญุ ูุชุญุชูู: ุงูุงุณูุ ุงูุตู/ุงูุดุนุจุฉุ ุงูุชุฃุฎุฑ/ุงูุบูุงุจ ุงููุชุฑุงููุ ูุจุงุฑููุฏ ุงููููุฉ.
          </div>
          <div class="actions" style="margin-top:10px">
            <button class="btn primary" data-action="print-entry-card">ุทุจุงุนุฉ ูุฑูุฉ ุฅุฐู ุฏุฎูู</button>
            <button class="btn ghost" data-action="print-behavior-card">ุทุจุงุนุฉ ุฅุดุนุงุฑ ุณูููู</button>
          </div>
        </div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section class="page" id="settings" hidden>
      <div class="grid">
        <div class="card">
          <h2>ุจูุงูุงุช ุงููุฏุฑุณุฉ</h2>
          <div class="field">
            <label>ุงุณู ุงููุฏุฑุณุฉ</label>
            <input id="set_schoolName">
          </div>
          <div class="field" style="margin-top:8px">
            <label>ุงูุชุฑููุณุฉ/ุงูุฌูุฉ</label>
            <input id="set_educationOffice">
          </div>
          <div class="row" style="margin-top:8px">
            <div class="field">
              <label>ุงูุนุงู ุงููุฌุฑู</label>
              <input id="set_hijriYear" placeholder="1447">
            </div>
            <div class="field">
              <label>ุงููุตู ุงูุฏุฑุงุณู</label>
              <select id="set_term">
                <option>ุงูุฃูู</option>
                <option>ุงูุซุงูู</option>
              </select>
            </div>
          </div>

          <div class="hr"></div>
          <h2 style="margin-top:0">ุฅุนุฏุงุฏุงุช SMS (ุงุฎุชูุงุฑู)</h2>
          <div class="help">ุถุน ููุง ุฑุงุจุท ูุณูุท Cloudflare Worker ูููุชุงุญ ุงูุญูุงูุฉ. ูุง ุชุถุน ุงูุชููู ุฏุงุฎู GitHub ุฃู ุฏุงุฎู ุงูุชุทุจูู.</div>
          <div class="field" style="margin-top:8px">
            <label>Proxy URL (ุฑุงุจุท ุงูุนุงูู)</label>
            <input id="set_proxyUrl" placeholder="ูุซุงู: https://xxx.workers.dev">
          </div>
          <div class="row" style="margin-top:8px">
            <div class="field">
              <label>Proxy Key (ููุชุงุญ ุงูุญูุงูุฉ)</label>
              <input id="set_proxyKey" placeholder="ุถุน ุงูููุชุงุญ ููุง ูุฑุฉ ูุงุญุฏุฉ">
            </div>
            <div class="field">
              <label>Sender Name</label>
              <input id="set_smsSender" placeholder="Mobile.SA">
            </div>
          </div>

          <div class="actions">
            <button class="btn primary" data-action="save-settings">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
          </div>
        </div>

        <div class="card">
          <h2>ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช</h2>
          <div class="help">ุงูุจูุงูุงุช ุชูุญูุธ ุฏุงุฎู ูุฐุง ุงูุฌูุงุฒ ููุท (offline). ุจุฅููุงูู ุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุงุณุชุฑุฌุงุนูุง.</div>

          <div class="hr"></div>
          <h2 style="margin-top:0">ุงุณุชูุฑุงุฏ ุจูุงูุงุช ุงูุทูุงุจ</h2>
          <div class="small">ูุฏุนู CSV ุจุงูุนูุงููู: ุงุณู ุงูุทุงูุจุ ุฑูู ุงูุทุงูุจุ ุงูุฌูุงูุ ุฑูู ุงูุตูุ ุงููุตู</div>
          <div class="actions" style="margin-top:10px">
            <button class="btn primary" data-action="import-students">ุงุณุชูุฑุงุฏ CSV</button>
            <input id="studentsFile" type="file" accept=".csv,text/csv" hidden>
          </div>

          <div class="hr"></div>
          <h2 style="margin-top:0">ูุณุฎุฉ ุงุญุชูุงุทูุฉ</h2>
          <div class="actions">
            <button class="btn" data-action="export-backup">ุชุตุฏูุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ</button>
            <button class="btn" data-action="import-backup">ุงุณุชูุฑุงุฏ ูุณุฎุฉ ุงุญุชูุงุทูุฉ</button>
            <input id="backupFile" type="file" accept="application/json,.json" hidden>
          </div>

          <div class="hr"></div>
          <h2 style="margin-top:0;color:#991b1b">ูุณุญ ูุงูู</h2>
          <div class="actions">
            <button class="btn danger" data-action="clear-all">ูุณุญ ุฌููุน ุงูุจูุงูุงุช ูู ูุฐุง ุงูุฌูุงุฒ</button>
          </div>
        </div>
      </div>

      <div class="footerNote">
        * ูุฐุง ุงูุฅุตุฏุงุฑ ููุญุณูู ููุทุจุงุนุฉ ูุงููุดููุ ููุณุชุฎุฏู ุจุงุฑููุฏ (Code39) ูุฑูู ุงููููุฉ ูุชุณููู ุงููุณุญ.
      </div>
    </section>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script type="module" src="app.js"></script>
  <script>
    // service worker
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('./sw.js').catch(()=>{});
    }
  </script>
</body>
</html>
