<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#0b7e88"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <title>ุฑุงุตุฏ - ุซุงูููุฉ ุงููุนููุจู</title>

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="assets/icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="assets/icon-192.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="app.css"/>

  <script defer src="db.js"></script>
  <script defer src="barcode.js"></script>
  <script defer src="rules.js"></script>
  <script defer src="sms.js"></script>
  <script defer src="assets/app.js"></script>
</head>

<body>
  <div class="topbar noPrint">
    <div class="container">
      <div class="row">
        <div class="brand">
          <div class="logo">ุฑ</div>
          <div>
            <h1>ุฑุงุตุฏ โ ูุชุงุจุนุฉ ุงูููุงุธุจุฉ ูุงูุณููู</h1>
            <p>ุจุญุซ ุณุฑูุน + ุณุฌู ุงูุทุงูุจ + ูุดูู ุทุจุงุนุฉ + ุญูุธ ูุญูู ุฏุงุฎู ุงูุฌูุงุฒ</p>
          </div>
        </div>
        <div class="grow"></div>
        <div class="pill">ูุถุน ุฏูู ุฅูุชุฑูุช: ูุนูู (ุจุนุฏ ูุชุญู ูุฑุฉ ูุงุญุฏุฉ)</div>
      </div>

      <div class="row" style="margin-top:10px">
        <div class="search grow">
          <span class="muted">๐</span>
          <input id="q" placeholder="ุงูุชุจ ุงุณู ุงูุทุงูุจ ุฃู ุฑูู ุงููููุฉโฆ" autocomplete="off" inputmode="search"/>
          <button class="btn ghost" id="btnClearSearch" title="ูุณุญ">ูุณุญ</button>
        </div>
        <div class="pill">ุฅุฌูุงูู ุงูุทูุงุจ: <b id="kTotal">0</b></div>
      </div>

      <div class="tabs">
        <button class="pill tab active" data-tab="students">ุงูุทูุงุจ</button>
        <button class="pill tab" data-tab="print">ุงูุทุจุงุนุฉ</button>
        <button class="pill tab" data-tab="data">ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช</button>
        <button class="pill tab" data-tab="settings">ุงูุฅุนุฏุงุฏุงุช</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div id="fatal" class="muted" style="padding:10px 2px"></div>

    <!-- Students tab -->
    <section class="panel" data-tab="students">
      <div class="grid">
        <div class="card">
          <h2>ูุชุงุฆุฌ ุงูุจุญุซ</h2>
          <div class="muted">ูู ุชุธูุฑ ุงูุฃุณูุงุก ุฅูุง ุนุจุฑ ุงูุจุญุซ (ุญูุงุธูุง ุนูู ุงูุฎุตูุตูุฉ ูุณูููุฉ ุงููุตูู).</div>
          <div class="list" id="results" style="margin-top:10px"></div>
        </div>

        <div class="card">
          <h2>ุชุนูููุงุช ุณุฑูุนุฉ</h2>
          <div class="kpis" style="margin-top:10px">
            <div class="kpi"><div class="muted">ูก) ุงุจุญุซ</div><b>ุจุงูุงุณู ุฃู ุงููููุฉ</b></div>
            <div class="kpi"><div class="muted">ูข) ุงุฎุชุฑ ุงูุทุงูุจ</div><b>ููุชุญ ูููู</b></div>
            <div class="kpi"><div class="muted">ูฃ) ุณุฌูู</div><b>ุชุฃุฎุฑ / ุบูุงุจ / ุณููู</b></div>
          </div>
          <hr/>
          <div class="muted">
            โข ุฅุฐุง ูู ุชุธูุฑ ุจูุงูุงุช ุงูุทูุงุจ: ุงุณุชุฎุฏู <b>ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช โ ุชุญููู ูุงุนุฏุฉ ุงูุทูุงุจ</b> ุฃู ุงุณุชูุฑุงุฏ CSV.<br/>
            โข ุฃู ุจูุงูุงุช ุชูุญูุธ ุฏุงุฎู ุงูุฌูุงุฒ (IndexedDB) ููุง ุชูุฑูุน ุชููุงุฆููุง ูุฃู ููุงู.
          </div>
        </div>
      </div>
    </section>

    <!-- Print tab -->
    <section class="panel" data-tab="print" style="display:none">
      <div class="grid">
        <div class="card">
          <h2>ูุดู ุฃุณุจูุนู (ุฃุญุฏ โ ุฎููุณ)</h2>
          <div class="muted">ุงููุดู ูุญุชูู: ุงุณู ุงูุทุงูุจ + ุฃูุงู ุงูุฃุณุจูุน + ุจุงุฑููุฏ ุฑูู ุงููููุฉ.</div>

          <div class="row" style="margin-top:10px">
            <div class="field grow">
              <label>ุชุงุฑูุฎ ุฏุงุฎู ุงูุฃุณุจูุน</label>
              <input id="printDate" type="date"/>
            </div>
            <div class="field grow">
              <label>ุงูุตู</label>
              <select id="printGrade"></select>
            </div>
            <div class="field grow">
              <label>ุงูุดุนุจุฉ</label>
              <select id="printSection"></select>
            </div>
          </div>

          <div class="row" style="margin-top:12px">
            <button class="btn" id="btnPrintLate">ุทุจุงุนุฉ ูุดู ุชุฃุฎุฑ</button>
            <button class="btn warn" id="btnPrintAbsent">ุทุจุงุนุฉ ูุดู ุบูุงุจ</button>
          </div>

          <hr/>
          <div class="muted">
            ููุงุญุธุฉ: ูููู ุทุจุงุนุฉ <b>ูุฑูุช ุตุบูุฑุฉ</b> ููุทุงูุจ ูู ูุงูุฐุฉ ุงูุทุงูุจ (ุจุนุฏ ุงุฎุชูุงุฑู).
          </div>
        </div>

        <div class="card">
          <h2>ูุฑูุช ุงูุทุงูุจ</h2>
          <div class="muted">ุจุนุฏ ุงุฎุชูุงุฑ ุงูุทุงูุจ ูู ุงูุจุญุซุ ููููู ุทุจุงุนุฉ:</div>
          <div class="row" style="margin-top:12px">
            <button class="btn" id="btnPrintCardLate">ูุฑุช ุชุฃุฎุฑ</button>
            <button class="btn warn" id="btnPrintCardAbsent">ูุฑุช ุบูุงุจ</button>
            <button class="btn danger" id="btnPrintCardBehavior">ูุฑุช ุณููู</button>
          </div>
          <hr/>
          <div class="muted">ุงููุฑุช ูุดูู: ุจูุงูุงุช ุงูุทุงูุจ + ุจุงุฑููุฏ ุงููููุฉ + ููุฎุต ุฃุฑุดูู (ูู ุชุฃุฎุฑ/ุบุงุจ/ุณููู).</div>
        </div>
      </div>
    </section>

    <!-- Data tab -->
    <section class="panel" data-tab="data" style="display:none">
      <div class="grid">
        <div class="card">
          <h2>ุงุณุชูุฑุงุฏ ุงูุทูุงุจ (CSV)</h2>
          <div class="muted">ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ (ุฃู ุงุณู ูู ุงูุชุงูู ูููู):</div>
          <ul class="muted">
            <li>ุงุณู ุงูุทุงูุจ: (ุงุณู ุงูุทุงูุจ / ุงูุงุณู / name)</li>
            <li>ุฑูู ุงููููุฉ: (ุฑูู ุงููููุฉ / ุงููููุฉ / idNumber / NationalID)</li>
            <li>ุงูุตู + ุงูุดุนุจุฉ (ุงุฎุชูุงุฑู ููู ููู ูููุดูู)</li>
          </ul>

          <input id="fileStudents" type="file" accept=".csv,text/csv" hidden>
          <div class="row" style="margin-top:10px">
            <button class="btn" id="btnImportStudents">ุงุณุชูุฑุงุฏ ููู CSV</button>
            <button class="btn ghost" id="btnLoadSeed">ุชุญููู ูุงุนุฏุฉ ุงูุทูุงุจ (600)</button>
          </div>

          <hr/>
          <div class="muted">
            ุฅุฐุง ูุงู ูููู Excel: ุงูุชุญู ูู Excel โ ุญูุธ ุจุงุณู โ CSV (UTF-8) ุซู ุงุณุชูุฑุฏู ููุง.
          </div>
        </div>

        <div class="card">
          <h2>ูุณุฎ ุงุญุชูุงุทู</h2>
          <div class="row" style="margin-top:10px">
            <button class="btn ghost" id="btnExport">ุชุตุฏูุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ</button>
            <button class="btn ghost" id="btnImportBackup">ุงุณุชูุฑุงุฏ ูุณุฎุฉ ุงุญุชูุงุทูุฉ</button>
            <input id="fileImportBackup" type="file" accept=".json,application/json" hidden>
          </div>
          <hr/>
          <button class="btn danger" id="btnClearAll">ูุณุญ ุฌููุน ุงูุจูุงูุงุช ูู ูุฐุง ุงูุฌูุงุฒ</button>
          <div class="muted" style="margin-top:8px">ุชูุจูู: ุงููุณุญ ููุงุฆู ุนูู ูุฐุง ุงูุฌูุงุฒ ููุท.</div>
        </div>
      </div>
    </section>

    <!-- Settings tab -->
    <section class="panel" data-tab="settings" style="display:none">
      <div class="grid">
        <div class="card">
          <h2>ุชุฑููุณุฉ ุงููุฏุฑุณุฉ (ุชุธูุฑ ูู ุงููุดูู)</h2>
          <div class="field">
            <label>ุงูุชุฑููุณุฉ ุงูุทูููุฉ</label>
            <input id="setSchoolHeader" placeholder="ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ ููุชุนููู..."/>
          </div>
          <div class="field" style="margin-top:10px">
            <label>ุงุณู ุงููุฏุฑุณุฉ ุงููุฎุชุตุฑ (ูููุฑูุช)</label>
            <input id="setSchoolShort" placeholder="ุซุงูููุฉ ุงููุนููุจู ุงูุซุงูููุฉ"/>
          </div>
          <div class="row" style="margin-top:10px">
            <div class="field grow">
              <label>ุงููุตู ุงูุฏุฑุงุณู</label>
              <select id="setTerm">
                <option>ุงููุตู ุงูุฏุฑุงุณู ุงูุฃูู</option>
                <option>ุงููุตู ุงูุฏุฑุงุณู ุงูุซุงูู</option>
              </select>
            </div>
            <div class="field grow">
              <label>ุงูุนุงู ุงููุฌุฑู</label>
              <input id="setHijri" placeholder="ูกูคูคูงูู"/>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>ุฅุนุฏุงุฏ ูุณูุท ุงูุฑุณุงุฆู (ุงุฎุชูุงุฑู)</h2>
          <div class="muted">ูุฅุฑุณุงู SMS ูููู ุงูุฃูุฑ ุนุจุฑ Cloudflare Worker Proxy (ูุญูู ุงูุชููู).</div>
          <div class="field" style="margin-top:10px">
            <label>ุฑุงุจุท ุงูู Worker (ูุซุงู: https://xxxxx.workers.dev)</label>
            <input id="setProxyUrl" placeholder="https://...workers.dev"/>
          </div>
          <div class="field" style="margin-top:10px">
            <label>Proxy Key (ููุชุงุญ ุญูุงูุฉ)</label>
            <input id="setProxyKey" placeholder="ุถุน ููุชุงุญ ููู ููุง"/>
          </div>
          <button class="btn" id="btnSaveSettings" style="margin-top:12px">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>

          <hr/>
          <h2>ุฅุฑุณุงู SMS ูู ููู ุงูุทุงูุจ</h2>
          <div class="field">
            <label>ูุต ุงูุฑุณุงูุฉ</label>
            <textarea id="smsMsg" placeholder="ูุซุงู: ูุฃูู ูุชุงุจุนุฉ ุงูุถุจุงุท ุงูุทุงูุจ..."></textarea>
          </div>
          <button class="btn" id="btnSendSMS" style="margin-top:10px">ุฅุฑุณุงู SMS</button>
          <div class="muted" style="margin-top:8px">ุณูุธูุฑ ุฒุฑ ุงูุฅุฑุณุงู ุจุนุฏ ุงุฎุชูุงุฑ ุทุงูุจ (ูู ุชุจููุจ ุงูุทูุงุจ).</div>
        </div>
      </div>
    </section>

  </div>

  <!-- Student modal -->
  <div class="modal" id="modal">
    <div class="box">
      <div class="head">
        <div>
          <h3 id="mName">โ</h3>
          <div id="mMeta" class="row" style="margin-top:6px;flex-wrap:wrap"></div>
        </div>
        <button class="btn ghost" id="modalClose">ุฅุบูุงู</button>
      </div>

      <div class="body">
        <div class="card" style="box-shadow:none">
          <h2>ููุฎุต ุณุฑูุน</h2>
          <div class="kpis">
            <div class="kpi"><div class="muted">ุชุฃุฎุฑ</div><b id="kLate">0</b></div>
            <div class="kpi"><div class="muted">ุบูุงุจ</div><b id="kAbsent">0</b></div>
            <div class="kpi"><div class="muted">ุณููู</div><b id="kBeh">0</b></div>
          </div>
          <hr/>
          <div id="mBarcode"></div>
        </div>

        <div class="card" style="box-shadow:none">
          <h2>ุชุณุฌูู ุงูููุงุธุจุฉ</h2>
          <div class="row">
            <div class="field grow">
              <label>ุงูุชุงุฑูุฎ</label>
              <input id="attDate" type="date"/>
            </div>
          </div>
          <div class="field" style="margin-top:10px">
            <label>ููุงุญุธุฉ (ุงุฎุชูุงุฑู)</label>
            <input id="attNote" placeholder="ุณุจุจ/ููุงุญุธุฉ ูุฎุชุตุฑุฉโฆ"/>
          </div>
          <div class="row" style="margin-top:10px">
            <button class="btn" id="btnLate">ุชุณุฌูู ุชุฃุฎุฑ</button>
            <button class="btn warn" id="btnAbsent">ุชุณุฌูู ุบูุงุจ</button>
          </div>

          <hr/>

          <h2>ุชุณุฌูู ุงูุณููู</h2>
          <div class="row">
            <div class="field grow">
              <label>ุงูุชุงุฑูุฎ</label>
              <input id="behDate" type="date"/>
            </div>
            <div class="field grow">
              <label>ุงููุฎุงููุฉ</label>
              <select id="selInfraction"></select>
            </div>
          </div>
          <div class="field" style="margin-top:10px">
            <label>ููุงุญุธุฉ (ุงุฎุชูุงุฑู)</label>
            <input id="behNote" placeholder="ุชูุงุตูู ูุฎุชุตุฑุฉโฆ"/>
          </div>
          <button class="btn danger" id="btnBehavior" style="margin-top:10px">ุชุณุฌูู ูุฎุงููุฉ</button>
        </div>

        <div class="card" style="grid-column:1/-1;box-shadow:none">
          <h2>ุงูุณุฌู</h2>
          <div id="history" class="muted"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>
  <div class="printArea" id="printArea"></div>
</body>
</html>
