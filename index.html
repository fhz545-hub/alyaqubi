<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#0b7e88"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <title>ูุชุงุจุนุฉ ุงูุทูุงุจ โ ุฎุตูุตูุฉ</title>

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- Excel import (SheetJS) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>

  <link rel="stylesheet" href="styles.css">
  <script src="app.js" defer></script>
</head>

<body>
  <!-- ููู ุงุฎุชูุงุฑู -->
  <div id="lockScreen" class="lock hidden" aria-hidden="true">
    <div class="lockCard">
      <div class="lockTitle">๐ ููู ุงูุชุทุจูู</div>
      <div class="muted">ุฃุฏุฎู ุฑูุฒ ุงูุฏุฎูู</div>
      <input id="pinInput" class="input" inputmode="numeric" autocomplete="one-time-code" maxlength="8" placeholder="โขโขโขโข">
      <button id="btnUnlock" class="btn primary">ูุชุญ</button>
      <div id="pinErr" class="err hidden">ุงูุฑูุฒ ุบูุฑ ุตุญูุญ</div>
    </div>
  </div>

  <header class="topbar">
    <div class="brand">
      <div class="logo">๐</div>
      <div class="titles">
        <div class="title">ูุชุงุจุนุฉ ุงูุทูุงุจ</div>
        <div class="subtitle">ูุถุน ุฎุตูุตูุฉ: ูุง ุชูุนุฑุถ ุฃุณูุงุก ุงูุทูุงุจ ูู ุงูููุงุฆู</div>
      </div>
    </div>

    <div class="actions">
      <button class="btn ghost" id="btnImport">ุงุณุชูุฑุงุฏ/ุชุญุฏูุซ ุจูุงูุงุช</button>
      <button class="btn ghost" id="btnBackup">ูุณุฎ ุงุญุชูุงุทู</button>
    </div>
  </header>

  <main class="main">
    <!-- ุดุงุดุฉ ุงูุจุญุซ (ุจุฏูู ูุงุฆูุฉ ุทูุงุจ ุฅุทูุงููุง) -->
    <section id="viewSearch" class="view active" aria-label="ุงูุจุญุซ">
      <div class="panel">
        <div class="searchHero">
          <div class="heroTitle">ุจุญุซ ุณุฑูุน ูุขูู</div>
          <div class="muted">ุงูุชุจ ุงุณู ุงูุทุงูุจ ุฃู ุฑูู ุงููููุฉ/ุงูุฅูุงูุฉ โ ูู ุชุธูุฑ ุฃุณูุงุก ูู ุงููุชุงุฆุฌ.</div>

          <div class="searchRow">
            <input id="studentSearch" class="input inputBig" placeholder="ุงูุชุจ ุงูุงุณู ุฃู ุฑูู ุงููููุฉ/ุงูุฅูุงูุฉ ุซู Enterโฆ">
            <button id="btnSearch" class="btn primary">ุจุญุซ</button>
          </div>

          <div class="hint small">
            โข ุฅุฐุง ุธูุฑุช ุนุฏุฉ ูุชุงุฆุฌุ ุณุชุธูุฑ ุจุฏูู ุฃุณูุงุก (ุงูุตู + ุขุฎุฑ 4 ุฃุฑูุงู) ูุงุฎุชูุงุฑ ุงูุณุฌู ุงูุตุญูุญ.
          </div>
        </div>
      </div>

      <!-- ุญุงูุฉ ุงูุจุญุซ -->
      <div class="panel" style="margin-top:12px">
        <div id="searchStatus" class="muted"></div>

        <!-- ูุงุฆูุฉ ูุชุงุฆุฌ ูุชุนุฏุฏุฉ (ุจุฏูู ุฃุณูุงุก) -->
        <div id="matchList" class="matchList hidden" aria-live="polite"></div>

        <!-- ุจุทุงูุฉ ุงูุทุงูุจ ุงููุฎุชุงุฑ (ุจูุงูุงุช ููููุนุฉ) -->
        <div id="studentCard" class="studentCard hidden" aria-live="polite">
          <div class="cardTop">
            <div>
              <div class="cardTitle">ุงูุจูุงูุงุช</div>
              <div class="cardSub muted small" id="studentMeta"></div>
            </div>
            <button class="btn ghost" id="btnClear">ุฅุฎูุงุก</button>
          </div>

          <div class="gridInfo">
            <div class="infoBox">
              <div class="infoLabel">ุงูุงุณู</div>
              <div class="infoValue" id="maskedName">โขโขโขโข</div>
            </div>
            <div class="infoBox">
              <div class="infoLabel">ุงูุตู/ุงูุดุนุจุฉ</div>
              <div class="infoValue" id="stClassView">โ</div>
            </div>
            <div class="infoBox">
              <div class="infoLabel">ุงููููุฉ/ุงูุฅูุงูุฉ</div>
              <div class="infoValue" id="stIdMasked">****</div>
            </div>
            <div class="infoBox">
              <div class="infoLabel">ุฌูุงู ููู ุงูุฃูุฑ</div>
              <div class="infoValue" id="stParentMasked">****</div>
            </div>
          </div>

          <div class="actionBar">
            <button id="btnOpenAttendance" class="btn primary wide">ููุงุธุจุฉ / ุญุถูุฑ</button>
            <button id="btnOpenBehavior" class="btn wide">ุณููู</button>
          </div>

          <div class="muted small" style="margin-top:10px">
            ููุงุญุธุฉ: ูุฅุฌุฑุงุกุงุช ุงูุชูููู ุงูุฑุณููุฉ ูููุซููู ูู ูุธุงู ููุฑ ููู ุงูููุงุฆุญุ ููุฐู ุงูุฃุฏุงุฉ ูููุชุงุจุนุฉ ุงูุฏุงุฎููุฉ.
          </div>
        </div>
      </div>
    </section>

    <!-- ุงูุณุฌู -->
    <section id="viewLog" class="view" aria-label="ุงูุณุฌู">
      <div class="panel">
        <div class="row">
          <select id="logFilter" class="input">
            <option value="all">ุงููู</option>
            <option value="attendance">ุงูููุงุธุจุฉ</option>
            <option value="behavior">ุงูุณููู</option>
            <option value="message">ุงูุฑุณุงุฆู</option>
          </select>
          <button id="btnExportXlsx" class="btn">ุชุตุฏูุฑ Excel</button>
          <button id="btnClearLog" class="btn danger">ูุณุญ ุงูุณุฌู</button>
        </div>
        <div class="hint small">ุงูุณุฌู ูุง ูุนุฑุถ ุฃุณูุงุกุ ูุชู ุญูุธู ุจุตูุบุฉ ููููุนุฉ.</div>
      </div>
      <div id="logList" class="cards"></div>
    </section>

    <!-- ุงูุฅุนุฏุงุฏุงุช -->
    <section id="viewSettings" class="view" aria-label="ุงูุฅุนุฏุงุฏุงุช">
      <div class="panel">
        <div class="grid2">
          <div>
            <label class="label">ุงุณู ุงููุฏุฑุณุฉ</label>
            <input id="setSchoolName" class="input" placeholder="ูุซุงู: ุซุงูููุฉ ุงููุนููุจู ุจุงูุฎุจุฑ">
          </div>
          <div>
            <label class="label">ุงุณู ูุฏูุฑ ุงููุฏุฑุณุฉ</label>
            <input id="setPrincipalName" class="input" placeholder="ูุซุงู: ููุฏ ุญุงูุฏ ุนูู ุงูุฒูุฑุงูู">
          </div>
          <div>
            <label class="label">ุฑูุฒ ุงูุฏููุฉ (ูููุงุชุณุงุจ)</label>
            <input id="setCountryCode" class="input" inputmode="numeric" placeholder="966" value="966">
          </div>
          <div>
            <label class="label">ููุงุฉ ุงูุชูุงุตู ุงูุงูุชุฑุงุถูุฉ</label>
            <select id="setDefaultChannel" class="input">
              <option value="whatsapp">ูุงุชุณุงุจ</option>
              <option value="sms">SMS</option>
              <option value="call">ุงุชุตุงู</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>

        <div class="grid2">
          <div class="card">
            <div class="cardTitle">ููู ุจุฑูุฒ (ุงุฎุชูุงุฑู)</div>
            <div class="muted">ูุญูู ุงููุตูู ููุชุทุจูู ุนูู ุงูุฌูุงุฒ ููุณู.</div>
            <div class="row">
              <input id="setPin" class="input" inputmode="numeric" maxlength="8" placeholder="ุฑูุฒ ุฌุฏูุฏ">
              <button id="btnSavePin" class="btn">ุญูุธ</button>
              <button id="btnClearPin" class="btn danger">ุฅุฒุงูุฉ</button>
            </div>
            <div class="muted small">ุงูููู ูุญูู ุนูู ุงูุฌูุงุฒ.</div>
          </div>

          <div class="card">
            <div class="cardTitle">ุฅุฏุงุฑุฉ ุชุตููู ุงููุฎุงููุงุช</div>
            <div class="muted">ูููู ุชุนุฏูู ููุงุฆู ุงููุฎุงููุงุช ูุฅุฌุฑุงุกุงุชูุง ุญุณุจ ุงูุฏููู ุงููุนุชูุฏ.</div>
            <button id="btnOpenTaxonomy" class="btn">ูุชุญ</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <button id="btnResetAll" class="btn danger">ุฅุนุงุฏุฉ ุถุจุท ุงูุจูุงูุงุช (ูุญูููุง)</button>
          <div class="muted small">ุณูุญุฐู ุฌููุน ุงูุจูุงูุงุช ูู ูุฐุง ุงูุฌูุงุฒ ููุท.</div>
        </div>
      </div>
    </section>
  </main>

  <nav class="bottomNav" aria-label="ุงูุชููู">
    <button class="tab active" data-view="viewSearch">ุจุญุซ</button>
    <button class="tab" data-view="viewLog">ุงูุณุฌู</button>
    <button class="tab" data-view="viewSettings">ุงูุฅุนุฏุงุฏุงุช</button>
  </nav>

  <!-- ===== ุงูููุงูุฐ ===== -->
  <dialog id="dlgAttendance" class="dlg">
    <form method="dialog" class="dlgBody">
      <div class="dlgHeader">
        <div class="dlgTitle">ููุงุธุจุฉ / ุญุถูุฑ / ุบูุงุจ</div>
        <button class="iconBtn" value="cancel" aria-label="ุฅุบูุงู">โ</button>
      </div>

      <div class="muted" id="attStudentLine"></div>

      <div class="grid2">
        <div>
          <label class="label">ุงูุญุงูุฉ</label>
          <select id="attStatus" class="input">
            <option value="present">ุญุถูุฑ</option>
            <option value="absent">ุบูุงุจ</option>
            <option value="late">ุชุฃุฎุฑ</option>
            <option value="early">ุฎุฑูุฌ ูุจูุฑ</option>
          </select>
        </div>
        <div>
          <label class="label">ุงูุชุงุฑูุฎ/ุงูููุช</label>
          <input id="attWhen" class="input" type="datetime-local">
        </div>
        <div>
          <label class="label">ุจุนุฐุฑุ</label>
          <select id="attExcused" class="input">
            <option value="no">ุจุฏูู ุนุฐุฑ</option>
            <option value="yes">ุจุนุฐุฑ</option>
          </select>
        </div>
        <div>
          <label class="label">ููุงุญุธุฉ ูุฎุชุตุฑุฉ</label>
          <input id="attNote" class="input" placeholder="ุณุจุจ/ุชูุงุตูู...">
        </div>
      </div>

      <div class="divider"></div>

      <div class="card">
        <div class="cardTitle">ูุต ุฑุณุงูุฉ ูููู ุงูุฃูุฑ (ุจุฏูู ุงุณู ุงูุทุงูุจ)</div>
        <textarea id="attMsg" class="textarea" rows="5"></textarea>
        <div class="row">
          <button id="btnAttSend" class="btn primary" value="default">ุฅุฑุณุงู</button>
          <button id="btnAttSave" class="btn" value="default">ุญูุธ ุจุฏูู ุฅุฑุณุงู</button>
        </div>
      </div>

      <input id="attStudentId" type="hidden">
    </form>
  </dialog>

  <dialog id="dlgBehavior" class="dlg">
    <form method="dialog" class="dlgBody">
      <div class="dlgHeader">
        <div class="dlgTitle">ุณููู</div>
        <button class="iconBtn" value="cancel" aria-label="ุฅุบูุงู">โ</button>
      </div>

      <div class="muted" id="behStudentLine"></div>

      <div class="grid2">
        <div>
          <label class="label">ุงูุฏุฑุฌุฉ</label>
          <select id="behDegree" class="input">
            <option value="1">ุงูุฃููู</option>
            <option value="2">ุงูุซุงููุฉ</option>
            <option value="3">ุงูุซุงูุซุฉ</option>
            <option value="4">ุงูุฑุงุจุนุฉ</option>
            <option value="5">ุงูุฎุงูุณุฉ</option>
          </select>
        </div>
        <div>
          <label class="label">ุงููุฎุงููุฉ</label>
          <select id="behViolation" class="input"></select>
        </div>
        <div>
          <label class="label">ุชุงุฑูุฎ/ููุช</label>
          <input id="behWhen" class="input" type="datetime-local">
        </div>
        <div>
          <label class="label">ุชูุงุตูู (ุงุฎุชูุงุฑู)</label>
          <input id="behNote" class="input" placeholder="...">
        </div>
      </div>

      <div class="card">
        <div class="row">
          <div><span class="pill" id="behPointsPill">ุฎุตู: 0</span></div>
          <div class="muted small" id="behActionsLine"></div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="card">
        <div class="cardTitle">ูุต ุฑุณุงูุฉ ูููู ุงูุฃูุฑ (ุจุฏูู ุงุณู ุงูุทุงูุจ)</div>
        <textarea id="behMsg" class="textarea" rows="6"></textarea>
        <div class="row">
          <button id="btnBehSend" class="btn primary" value="default">ุฅุฑุณุงู</button>
          <button id="btnBehSave" class="btn" value="default">ุญูุธ ุจุฏูู ุฅุฑุณุงู</button>
        </div>
      </div>

      <input id="behStudentId" type="hidden">
    </form>
  </dialog>

  <dialog id="dlgTaxonomy" class="dlg">
    <form method="dialog" class="dlgBody">
      <div class="dlgHeader">
        <div class="dlgTitle">ุชุตููู ุงููุฎุงููุงุช</div>
        <button class="iconBtn" value="cancel" aria-label="ุฅุบูุงู">โ</button>
      </div>
      <div class="muted">ุนุฏูู ุงููุงุฆูุฉ ููู ุงูุฏููู ุงููุนุชูุฏ.</div>
      <textarea id="taxJson" class="textarea" rows="14" spellcheck="false"></textarea>
      <div class="row">
        <button id="btnSaveTax" class="btn primary" value="default">ุญูุธ</button>
        <button class="btn" value="cancel">ุฅูุบุงุก</button>
      </div>
    </form>
  </dialog>

  <dialog id="dlgBackup" class="dlg">
    <form method="dialog" class="dlgBody">
      <div class="dlgHeader">
        <div class="dlgTitle">ูุณุฎ ุงุญุชูุงุทู / ุงุณุชุนุงุฏุฉ</div>
        <button class="iconBtn" value="cancel" aria-label="ุฅุบูุงู">โ</button>
      </div>

      <div class="row">
        <button id="btnDoBackup" class="btn primary" value="default">ุชุญููู ูุณุฎุฉ JSON</button>
        <label class="btn" for="restoreFile">ุงุณุชุนุงุฏุฉ</label>
        <input id="restoreFile" type="file" accept="application/json" class="hidden">
      </div>

      <div class="muted small">ุงููุณุฎ ุงูุงุญุชูุงุทู ูููู ุงูุจูุงูุงุช ุจูู ุงูุฃุฌูุฒุฉ.</div>
    </form>
  </dialog>

  <!-- ูุฏุฎูุงุช ูููุงุช -->
  <input id="importFile" type="file" accept=".xlsx,.xls" class="hidden">

  <!-- republish -->
</body>
</html>
