<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#0b7e88"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <title>ثانوية اليعقوبي الثانوية - رصد</title>

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="assets/icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="assets/icon-192.png">

  <link rel="stylesheet" href="assets/app.css">
</head>
<body>

  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true">YQ</div>
        <div class="title">
          <b id="schoolTitle">ثانوية اليعقوبي الثانوية</b>
          <small id="schoolSub">رصد | مواظبة وسلوك (بدون إنترنت)</small>
        </div>
      </div>
      <div class="chips">
        <span class="chip"><strong>خصوصية:</strong> لا تظهر الأسماء إلا بالبحث</span>
        <span class="chip"><strong>PWA</strong> تثبيت على الجوال</span>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <!-- Left panel -->
      <section class="card">
        <div class="hd">
          <h2>بحث سريع</h2>
          <div class="sub">اكتب الاسم أو رقم الهوية</div>
        </div>
        <div class="bd">
          <div class="searchbox">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2"/><path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            <input id="quickSearch" placeholder="مثال: راشد خضران … أو 1148961236" autocomplete="off" inputmode="search"/>
            <span class="kbd">Enter</span>
          </div>
          <div class="hr"></div>
          <div id="quickResults" class="list"></div>
        </div>
      </section>

      <!-- Right panel -->
      <section class="screen card" data-screen="home" id="tab-home">
        <div class="hd">
          <div>
            <h2>لوحة المتابعة</h2>
            <div class="sub">سجّل المواظبة والسلوك بسهولة</div>
          </div>
          <div class="btns">
            <button class="btn primary small" data-tab="record" type="button">تسجيل سريع</button>
            <button class="btn small" data-tab="print" type="button">طباعة</button>
          </div>
        </div>
        <div class="bd">
          <div id="homeStats"></div>
          <div class="hr"></div>
          <h3 style="margin:0 0 10px;font-size:14px">آخر العمليات</h3>
          <div id="recentList" class="list"></div>
        </div>
      </section>

      <section class="screen card hidden" data-screen="search" id="tab-search">
        <div class="hd">
          <div>
            <h2>بحث الطلاب</h2>
            <div class="sub">لا تظهر النتائج إلا بعد كتابة حرفين أو 3 أرقام</div>
          </div>
          <div class="btns">
            <button class="btn small" data-tab="home" type="button">الرئيسية</button>
          </div>
        </div>
        <div class="bd">
          <div class="searchbox">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2"/><path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            <input id="searchInput" placeholder="ابحث بالاسم أو رقم الهوية" autocomplete="off" inputmode="search"/>
          </div>

          <div class="hr"></div>
          <div class="grid" style="grid-template-columns:1fr;gap:12px">
            <div>
              <h3 style="margin:0 0 10px;font-size:14px">النتائج</h3>
              <div id="searchResults" class="list"></div>
            </div>
            <div>
              <h3 style="margin:0 0 10px;font-size:14px">ملف الطالب</h3>
              <div id="studentView">
                <div class="print-note">اختر طالبًا من النتائج لعرض ملفه.</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="screen card hidden" data-screen="record" id="tab-record">
        <div class="hd">
          <div>
            <h2>تسجيل سريع</h2>
            <div class="sub">سجّل تأخر/غياب/سلوك خلال ثوانٍ</div>
          </div>
          <div class="btns">
            <button class="btn small" data-tab="home" type="button">الرئيسية</button>
            <button class="btn small" data-tab="search" type="button">ملف طالب</button>
          </div>
        </div>
        <div class="bd">
          <div class="searchbox">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2"/><path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            <input id="recordSearch" placeholder="ابحث عن الطالب للتسجيل" autocomplete="off" inputmode="search"/>
          </div>
          <div class="print-note" id="recordHint">اكتب حرفين على الأقل أو 3 أرقام لعرض النتائج.</div>
          <div class="hr"></div>
          <div id="recordResults" class="list"></div>
        </div>
      </section>

      <section class="screen card hidden" data-screen="print" id="tab-print">
        <div class="hd">
          <div>
            <h2>الطباعة</h2>
            <div class="sub">كشوف + بطاقات باركود</div>
          </div>
          <div class="btns">
            <button class="btn small" data-tab="home" type="button">الرئيسية</button>
          </div>
        </div>
        <div class="bd">
          <div class="row">
            <div class="field">
              <label>الصف</label>
              <select id="printGrade"></select>
            </div>
            <div class="field">
              <label>الشعبة</label>
              <select id="printSection"></select>
            </div>
            <div class="field">
              <label>الفصل الدراسي</label>
              <select id="printTerm">
                <option value="الأول">الأول</option>
                <option value="الثاني">الثاني</option>
              </select>
            </div>
            <div class="field">
              <label>العام الهجري</label>
              <input id="printHijri" value="١٤٤٧هـ"/>
            </div>
          </div>
          <div class="hr"></div>
          <div class="btns">
            <button class="btn primary" id="btnPrintLate" type="button">طباعة كشف تأخر (A4)</button>
            <button class="btn primary" id="btnPrintAbsent" type="button">طباعة كشف غياب (A4)</button>
            <button class="btn" id="btnPrintLateCards" type="button">طباعة بطاقات مواظبة (A4)</button>
            <button class="btn" id="btnPrintBehaviorCards" type="button">طباعة بطاقات سلوك (A4)</button>
            <button class="btn" id="btnExportRosterCSV" type="button">تصدير كشف CSV</button>
          </div>
          <div class="print-note">الكشف يحتوي: اسم الطالب + أيام الأحد إلى الخميس + باركود رقم الهوية (للمسح في السجلات الورقية).</div>
        </div>
      </section>

      <section class="screen card hidden" data-screen="settings" id="tab-settings">
        <div class="hd">
          <div>
            <h2>الإعدادات والنسخ الاحتياطي</h2>
            <div class="sub">تحكم كامل بالبيانات على جهازك</div>
          </div>
          <div class="btns">
            <button class="btn small" data-tab="home" type="button">الرئيسية</button>
          </div>
        </div>
        <div class="bd">
          <div class="row">
            <div class="field" style="flex:1 1 320px">
              <label>اسم المدرسة</label>
              <input id="schoolName" placeholder="ثانوية اليعقوبي الثانوية"/>
            </div>
          </div>

          <div class="hr"></div>
          <h3 style="margin:0 0 10px;font-size:14px">الرسائل SMS (Proxy وسيط)</h3>
          <div class="row">
            <div class="field" style="flex:1 1 280px">
              <label>Proxy URL</label>
              <input id="smsProxyUrl" placeholder="https://xxxx.workers.dev"/>
            </div>
            <div class="field" style="flex:1 1 220px">
              <label>App Key (حماية)</label>
              <input id="smsAppKey" placeholder="مفتاح داخلي للتطبيق"/>
            </div>
            <div class="field" style="flex:1 1 160px">
              <label>Sender (اختياري)</label>
              <input id="smsSender" placeholder="YAQUBI"/>
            </div>
          </div>
          <div class="btns" style="margin-top:10px">
            <button class="btn primary" id="btnSaveSettings" type="button">حفظ الإعدادات</button>
          </div>
          <div class="print-note">لأمان الحساب: لا تضع توكن المزود داخل التطبيق. استخدم Cloudflare Worker كـ Proxy.</div>

          <div class="hr"></div>
          <h3 style="margin:0 0 10px;font-size:14px">الطلاب</h3>
          <div class="btns">
            <button class="btn" id="btnResetSeed" type="button">إعادة استيراد ملف الطلاب الأساسي (600)</button>
            <button class="btn" id="btnImportStudents" type="button">استيراد طلاب من CSV</button>
            <input id="importStudentsFile" type="file" accept=".csv,text/csv" hidden>
          </div>
          <div class="print-note">ملاحظة: استيراد CSV يضيف/يحدّث الطلاب. (الباركود يتوفر تلقائيًا لملف الطلاب الأساسي.)</div>

          <div class="hr"></div>
          <h3 style="margin:0 0 10px;font-size:14px">السجلات والنسخ الاحتياطي</h3>
          <div class="btns">
            <button class="btn" id="btnExport" type="button">تصدير نسخة احتياطية</button>
            <button class="btn" id="btnImport" type="button">استيراد نسخة احتياطية</button>
            <input id="importFile" type="file" accept="application/json,.json" hidden>
            <button class="btn danger" id="btnClearData" type="button">حذف سجلات المواظبة والسلوك</button>
          </div>
          <div class="print-note">تلميح: شغّل التطبيق على جهاز واحد مسؤول ثم صدّر نسخة احتياطية بشكل دوري.</div>
        </div>
      </section>

    </div>
  </main>

  <nav class="nav" aria-label="التنقل">
    <div class="nav-inner nav">
      <button class="active" data-tab="home" type="button">
        <svg viewBox="0 0 24 24" fill="none"><path d="M3 11.5 12 4l9 7.5V20a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1v-8.5Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
        <span>الرئيسية</span>
      </button>
      <button data-tab="search" type="button">
        <svg viewBox="0 0 24 24" fill="none"><path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2"/><path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <span>بحث</span>
      </button>
      <button data-tab="record" type="button">
        <svg viewBox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <span>تسجيل</span>
      </button>
      <button data-tab="print" type="button">
        <svg viewBox="0 0 24 24" fill="none"><path d="M7 8V4h10v4M7 17v3h10v-3M6 10h12a3 3 0 0 1 3 3v3h-3v-2H6v2H3v-3a3 3 0 0 1 3-3Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
        <span>طباعة</span>
      </button>
      <button data-tab="settings" type="button">
        <svg viewBox="0 0 24 24" fill="none"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" stroke="currentColor" stroke-width="2"/><path d="M19.4 15a7.8 7.8 0 0 0 .1-1l2-1.2-2-3.5-2.3.5a7.4 7.4 0 0 0-1.7-1l-.4-2.3H9l-.4 2.3a7.4 7.4 0 0 0-1.7 1L4.6 9.3l-2 3.5 2 1.2a7.8 7.8 0 0 0 .1 1L2.6 16.2l2 3.5 2.3-.5a7.4 7.4 0 0 0 1.7 1l.4 2.3h6l.4-2.3a7.4 7.4 0 0 0 1.7-1l2.3.5 2-3.5-2-1.2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
        <span>إعدادات</span>
      </button>
    </div>
  </nav>

  <!-- Modal -->
  <div class="modal-backdrop" id="modalBack" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="mh">
        <b id="modalTitle"></b>
        <button class="btn small" id="modalClose" type="button">إغلاق</button>
      </div>
      <div class="mb" id="modalBody"></div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast hidden" id="toast" aria-live="polite">
    <div class="t" id="toastText"></div>
  </div>

  <script src="assets/app.js"></script>
</body>
</html>
