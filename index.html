<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#0b7e88"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <title>ูุชุงุจุนุฉ ุงูุทูุงุจ</title>

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- Excel import (SheetJS) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>

  <link rel="stylesheet" href="styles.css">
  <script src="app.js" defer></script>
</head>

<body>
  <div id="lockScreen" class="lock hidden" aria-hidden="true">
    <div class="lockCard">
      <div class="lockTitle">๐ ููู ุงูุชุทุจูู</div>
      <div class="muted">ุฃุฏุฎู ุฑูุฒ ุงูุฏุฎูู</div>
      <input id="pinInput" class="input" inputmode="numeric" autocomplete="one-time-code" maxlength="8" placeholder="โขโขโขโข">
      <button id="btnUnlock" class="btn primary">ูุชุญ</button>
      <div id="pinErr" class="err hidden">ุงูุฑูุฒ ุบูุฑ ุตุญูุญ</div>
    </div>
  </div>

  <header class="topbar">
    <div class="brand">
      <div class="logo">๐</div>
      <div class="titles">
        <div class="title">ูุชุงุจุนุฉ ุงูุทูุงุจ</div>
        <div class="subtitle" id="subtitle">ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุนูู ุงูุฌูุงู (PWA) โ ุจูุงูุงุช ูุญููุฉ ุขููุฉ</div>
      </div>
    </div>
    <div class="actions">
      <button class="btn ghost" id="btnImport">ุชุญุฏูุซ/ุงุณุชูุฑุงุฏ ุจูุงูุงุช</button>
      <button class="btn ghost" id="btnBackup">ูุณุฎ ุงุญุชูุงุทู</button>
    </div>
  </header>

  <main class="main">
    <section id="viewStudents" class="view active" aria-label="ุงูุทูุงุจ">
      <div class="panel">
        <div class="row">
          <input id="studentSearch" class="input" type="search" autocomplete="off" spellcheck="false" placeholder="ุงุจุญุซ ุจุงูุงุณู ุฃู ุฑูู ุงููููุฉ/ุงูุฅูุงูุฉ...">
          <select id="classFilter" class="input" style="max-width:260px">
            <option value="all">ูู ุงูุตููู</option>
          </select>
          <button id="btnAddStudent" class="btn">ุฅุถุงูุฉ ุทุงูุจ</button>
          <button id="btnImportParents" class="btn ghost">ุงุณุชูุฑุงุฏ ุฃูููุงุก ุงูุฃููุฑ</button>
        </div>
        <div id="countLine" class="muted small" style="margin-top:8px"></div>

        <div class="stats" aria-label="ุฅุญุตุงุกุงุช ุณุฑูุนุฉ">
          <div class="statCard"><div class="statLabel">ุฅุฌูุงูู ุงูุทูุงุจ</div><div class="statValue" id="statTotal">0</div></div>
          <div class="statCard"><div class="statLabel">ุฌูุงู ููู ุงูุฃูุฑ</div><div class="statValue" id="statParentsReady">0</div></div>
          <div class="statCard"><div class="statLabel">ุบูุงุจ ุงูููู</div><div class="statValue" id="statAbsentToday">0</div></div>
          <div class="statCard"><div class="statLabel">ุณููู ุงูููู</div><div class="statValue" id="statBehaviorToday">0</div></div>
        </div>

        <div class="hint">
          ุชูุจูู: ุชูุญูุธ ุงูุจูุงูุงุช ูุญูููุง ุนูู ุฌูุงุฒู. ูููุงุนุชุฏุงุฏ ุงูุฑุณูู ูุชู ุชูุซูู ูุง ููุฒู ูู ูุธุงู ููุฑ ููู ุงูุฃูุธูุฉ.
        </div>
      </div>

      <div id="studentsList" class="cards" aria-live="polite"></div>
    </section>

    <section id="viewLog" class="view" aria-label="ุงูุณุฌู">
      <div class="panel">
        <div class="row">
          <select id="logFilter" class="input">
            <option value="all">ุงููู</option>
            <option value="attendance">ุงูุญุถูุฑ</option>
            <option value="behavior">ุงูุณููู</option>
            <option value="message">ุงูุฑุณุงุฆู</option>
          </select>
          <button id="btnExportXlsx" class="btn">ุชุตุฏูุฑ Excel</button>
        </div>
      </div>
      <div id="logList" class="cards"></div>
    </section>

    <section id="viewSettings" class="view" aria-label="ุงูุฅุนุฏุงุฏุงุช">
      <div class="panel">
        <div class="grid2">
          <div>
            <label class="label">ุงุณู ุงููุฏุฑุณุฉ</label>
            <input id="setSchoolName" class="input" placeholder="ูุซุงู: ุซุงูููุฉ ุงููุนููุจู ุจุงูุฎุจุฑ">
          </div>
          <div>
            <label class="label">ุงุณู ูุฏูุฑ ุงููุฏุฑุณุฉ</label>
            <input id="setPrincipalName" class="input" placeholder="ูุซุงู: ููุฏ ุญุงูุฏ ุนูู ุงูุฒูุฑุงูู">
          </div>
          <div>
            <label class="label">ุฑูุฒ ุงูุฏููุฉ (ูููุงุชุณุงุจ)</label>
            <input id="setCountryCode" class="input" inputmode="numeric" placeholder="966" value="966">
          </div>
          <div>
            <label class="label">ููุงุฉ ุงูุชูุงุตู ุงูุงูุชุฑุงุถูุฉ</label>
            <select id="setDefaultChannel" class="input">
              <option value="whatsapp">ูุงุชุณุงุจ</option>
              <option value="sms">SMS</option>
              <option value="call">ุงุชุตุงู</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>

        <div class="grid2">
          <div class="card">
            <div class="cardTitle">ููู ุจุฑูุฒ (ุงุฎุชูุงุฑู)</div>
            <div class="muted">ูุญูู ุงููุตูู ููุชุทุจูู ุนูู ุงูุฌูุงุฒ ููุณู.</div>
            <div class="row">
              <input id="setPin" class="input" inputmode="numeric" maxlength="8" placeholder="ุฑูุฒ ุฌุฏูุฏ">
              <button id="btnSavePin" class="btn">ุญูุธ</button>
              <button id="btnClearPin" class="btn danger">ุฅุฒุงูุฉ</button>
            </div>
            <div class="muted small">ููุงุญุธุฉ: ุงูููู ูุญููุ ูููุณ ุจุฏููุงู ุนู ุณูุงุณุงุช ุฃูู ุงููุนูููุงุช.</div>
          </div>

          <div class="card">
            <div class="cardTitle">ุฅุฏุงุฑุฉ ุชุตููู ุงููุฎุงููุงุช</div>
            <div class="muted">ูููู ุชุนุฏูู ููุงุฆู ุงููุฎุงููุงุช ูุฅุฌุฑุงุกุงุชูุง ุญุณุจ ุฏููู ููุงุนุฏ ุงูุณููู ูุงูููุงุธุจุฉ.</div>
            <button id="btnOpenTaxonomy" class="btn">ูุชุญ</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <button id="btnResetDemo" class="btn danger">ุฅุนุงุฏุฉ ุถุจุท ุงูุจูุงูุงุช (ูุญูููุง)</button>
          <div class="muted small">ุณูุญุฐู ุฌููุน ุงูุจูุงูุงุช ูู ูุฐุง ุงูุฌูุงุฒ ููุท.</div>
        </div>
      </div>
    </section>
  </main>

  <nav class="bottomNav" aria-label="ุงูุชููู">
    <button class="tab active" data-view="viewStudents">ุงูุทูุงุจ</button>
    <button class="tab" data-view="viewLog">ุงูุณุฌู</button>
    <button class="tab" data-view="viewSettings">ุงูุฅุนุฏุงุฏุงุช</button>
  </nav>

  <!-- Modals -->
  <dialog id="dlgStudent" class="dlg">
    <form method="dialog" class="dlgBody">
      <div class="dlgHeader">
        <div class="dlgTitle" id="dlgStudentTitle">ุจูุงูุงุช ุงูุทุงูุจ</div>
        <button class="iconBtn" value="cancel" aria-label="ุฅุบูุงู">โ</button>
      </div>

      <div class="grid2">
        <div>
          <label class="label">ุงุณู ุงูุทุงูุจ</label>
          <input id="stName" class="input" required>
        </div>
        <div>
          <label class="label">ุฑูู ุงููููุฉ/ุงูุฅูุงูุฉ</label>
          <input id="stIdNumber" class="input" inputmode="numeric">
        </div>
        <div>
          <label class="label">ุงูุตู/ุงูุดุนุจุฉ (ุงุฎุชูุงุฑู)</label>
          <input id="stClass" class="input" placeholder="ูุซุงู: ุซุงูุซ ุซ/3">
        </div>
        <div>
          <label class="label">ููุงุญุธุงุช</label>
          <input id="stNotes" class="input" placeholder="...">
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid2">
        <div>
          <label class="label">ุงุณู ููู ุงูุฃูุฑ (ุงุฎุชูุงุฑู)</label>
          <input id="stParentName" class="input" placeholder="...">
        </div>
        <div>
          <label class="label">ุฌูุงู ููู ุงูุฃูุฑ (ูููุงุชุณุงุจ/SMS)</label>
          <input id="stParentMobile" class="input" inputmode="tel" placeholder="05xxxxxxxx">
        </div>
      </div>

      <div class="divider"></div>

      <div class="row">
        <button id="btnSaveStudent" class="btn primary" value="default">ุญูุธ</button>
        <button id="btnDeleteStudent" class="btn danger" value="cancel">ุญุฐู</button>
      </div>
      <input id="stInternalId" type="hidden">
    </form>
  </dialog>

  <dialog id="dlgAttendance" class="dlg">
    <form method="dialog" class="dlgBody">
      <div class="dlgHeader">
        <div class="dlgTitle">ุชุณุฌูู ูุชุงุจุนุฉ (ุญุถูุฑ/ุบูุงุจ/ุชุฃุฎุฑ)</div>
        <button class="iconBtn" value="cancel" aria-label="ุฅุบูุงู">โ</button>
      </div>

      <div class="muted" id="attStudentLine"></div>

      <div class="grid2">
        <div>
          <label class="label">ุงูุญุงูุฉ</label>
          <select id="attStatus" class="input">
            <option value="present">ุญุถูุฑ</option>
            <option value="absent">ุบูุงุจ</option>
            <option value="late">ุชุฃุฎุฑ</option>
            <option value="early">ุฎุฑูุฌ ูุจูุฑ</option>
          </select>
        </div>
        <div>
          <label class="label">ุงูุชุงุฑูุฎ/ุงูููุช</label>
          <input id="attWhen" class="input" type="datetime-local">
        </div>
        <div>
          <label class="label">ุจุนุฐุฑุ</label>
          <select id="attExcused" class="input">
            <option value="no">ุจุฏูู ุนุฐุฑ</option>
            <option value="yes">ุจุนุฐุฑ</option>
          </select>
        </div>
        <div>
          <label class="label">ููุงุญุธุฉ ูุฎุชุตุฑุฉ</label>
          <input id="attNote" class="input" placeholder="ุณุจุจ/ุชูุงุตูู...">
        </div>
      </div>

      <div class="divider"></div>

      <div class="card">
        <div class="cardTitle">ูุต ุงูุฑุณุงูุฉ ุงูููุชุฑุญ (ูุงุจู ููุชุนุฏูู)</div>
        <textarea id="attMsg" class="textarea" rows="5"></textarea>
        <div class="row">
          <button id="btnAttSend" class="btn primary" value="default">ุฅุฑุณุงู</button>
          <button id="btnAttSave" class="btn" value="default">ุญูุธ ุจุฏูู ุฅุฑุณุงู</button>
        </div>
      </div>

      <input id="attStudentId" type="hidden">
    </form>
  </dialog>

  <dialog id="dlgBehavior" class="dlg">
    <form method="dialog" class="dlgBody">
      <div class="dlgHeader">
        <div class="dlgTitle">ุชุณุฌูู ูุฎุงููุฉ ุณููููุฉ</div>
        <button class="iconBtn" value="cancel" aria-label="ุฅุบูุงู">โ</button>
      </div>

      <div class="muted" id="behStudentLine"></div>

      <div class="grid2">
        <div>
          <label class="label">ุงูุฏุฑุฌุฉ</label>
          <select id="behDegree" class="input">
            <option value="1">ุงูุฃููู</option>
            <option value="2">ุงูุซุงููุฉ</option>
            <option value="3">ุงูุซุงูุซุฉ</option>
            <option value="4">ุงูุฑุงุจุนุฉ</option>
            <option value="5">ุงูุฎุงูุณุฉ</option>
          </select>
        </div>
        <div>
          <label class="label">ุงููุฎุงููุฉ</label>
          <select id="behViolation" class="input"></select>
        </div>
        <div>
          <label class="label">ุชุงุฑูุฎ/ููุช</label>
          <input id="behWhen" class="input" type="datetime-local">
        </div>
        <div>
          <label class="label">ุชูุงุตูู (ุงุฎุชูุงุฑู)</label>
          <input id="behNote" class="input" placeholder="...">
        </div>
      </div>

      <div class="card">
        <div class="row">
          <div><span class="pill" id="behPointsPill">ุฎุตู: 0</span></div>
          <div class="muted small" id="behActionsLine"></div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="card">
        <div class="cardTitle">ูุต ุงูุฑุณุงูุฉ ุงูููุชุฑุญ (ูุงุจู ููุชุนุฏูู)</div>
        <textarea id="behMsg" class="textarea" rows="6"></textarea>
        <div class="row">
          <button id="btnBehSend" class="btn primary" value="default">ุฅุฑุณุงู</button>
          <button id="btnBehSave" class="btn" value="default">ุญูุธ ุจุฏูู ุฅุฑุณุงู</button>
        </div>
      </div>

      <input id="behStudentId" type="hidden">
    </form>
  </dialog>

  <dialog id="dlgTaxonomy" class="dlg">
    <form method="dialog" class="dlgBody">
      <div class="dlgHeader">
        <div class="dlgTitle">ุชุตููู ุงููุฎุงููุงุช ูุงูุฅุฌุฑุงุกุงุช</div>
        <button class="iconBtn" value="cancel" aria-label="ุฅุบูุงู">โ</button>
      </div>

      <div class="muted">
        ููููู ุชุนุฏูู ุงููุงุฆูุฉ ููุง. ุงุญุฑุต ุนูู ูุทุงุจูุฉ ุงููุต ูุงูุฅุฌุฑุงุกุงุช ูุน ุงูุฏููู ุงููุนุชูุฏ ูู ุงููุฏุฑุณุฉ.
      </div>

      <textarea id="taxJson" class="textarea" rows="14" spellcheck="false"></textarea>

      <div class="row">
        <button id="btnSaveTax" class="btn primary" value="default">ุญูุธ</button>
        <button class="btn" value="cancel">ุฅูุบุงุก</button>
      </div>
    </form>
  </dialog>

  <dialog id="dlgBackup" class="dlg">
    <form method="dialog" class="dlgBody">
      <div class="dlgHeader">
        <div class="dlgTitle">ูุณุฎ ุงุญุชูุงุทู / ุงุณุชุนุงุฏุฉ</div>
        <button class="iconBtn" value="cancel" aria-label="ุฅุบูุงู">โ</button>
      </div>

      <div class="row">
        <button id="btnDoBackup" class="btn primary" value="default">ุชุญููู ูุณุฎุฉ JSON</button>
        <label class="btn" for="restoreFile">ุงุณุชุนุงุฏุฉ</label>
        <input id="restoreFile" type="file" accept="application/json" class="hidden">
      </div>

      <div class="muted small">
        ุงููุณุฎ ุงูุงุญุชูุงุทู ูุณุงุนุฏู ูู ููู ุงูุจูุงูุงุช ุจูู ุงูุฃุฌูุฒุฉ ุฃู ุญูุธูุง ูู ููุงู ุขูู.
      </div>
    </form>
  </dialog>

  <input id="importFile" type="file" accept=".xlsx,.xls" class="hidden">
  <input id="parentImportFile" type="file" accept=".xlsx,.xls" class="hidden">
</body>
</html>
